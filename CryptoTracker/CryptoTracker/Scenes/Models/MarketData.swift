//
//  MarketData.swift
//  CryptoTracker
//
//  Created by Ian on 2021/12/25.
//

import Foundation

// JSON Data
/*:
 URL: https://api.coingecko.com/api/v3/global

 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 11990,
     "upcoming_icos": 0,
     "ongoing_icos": 50,
     "ended_icos": 3375,
     "markets": 697,
     "total_market_cap": {
       "btc": 49083742.113326885,
       "eth": 614489623.5833989,
       "ltc": 15422390485.9264,
       "bch": 5532157921.881329,
       "bnb": 4575527581.181188,
       "eos": 731039234578.6895,
       "xrp": 2701655303081.458,
       "xlm": 8582093778774.39,
       "link": 114914771901.26111,
       "dot": 87809460684.89851,
       "yfi": 79340960.15804069,
       "usd": 2493446799783.083,
       "aed": 9158430095603.248,
       "ars": 254968649235218.94,
       "aud": 3451783129705.307,
       "bdt": 213741084752629.78,
       "bhd": 939680360966.2511,
       "bmd": 2493446799783.083,
       "brl": 14149966493110.6,
       "cad": 3194541703712.0903,
       "chf": 2295060692051.938,
       "clp": 2157878729468273.5,
       "cny": 15877271842298.748,
       "czk": 55122877747484.43,
       "dkk": 16380698751174.955,
       "eur": 2202204733228.018,
       "gbp": 1862866571351.9363,
       "hkd": 19449508400007.98,
       "huf": 813212739281255.4,
       "idr": 35358945706023932,
       "ils": 7858870558024.319,
       "inr": 187296380910212.66,
       "jpy": 285266521299383.25,
       "krw": 2959771220278514.5,
       "kwd": 754454665444.3677,
       "lkr": 504929776585497.9,
       "mmk": 4433404562436247,
       "mxn": 51409387428567.73,
       "myr": 10460009325090.031,
       "ngn": 1024657027902856.9,
       "nok": 22086951752478.52,
       "nzd": 3657689472984.597,
       "php": 124708676989367.1,
       "pkr": 444082875041366.6,
       "pln": 10175130534768.023,
       "rub": 183673524889021,
       "sar": 9361867926550.74,
       "sek": 22761429111819.848,
       "sgd": 3388843545585.1846,
       "thb": 83305017813437.2,
       "try": 26667937147507.98,
       "twd": 69054263707232.375,
       "uah": 67857538902570.08,
       "vef": 249668828062.2799,
       "vnd": 57237071289020536,
       "zar": 38800525651424.53,
       "xdr": 1778219039392.9028,
       "xag": 109050945657.449,
       "xau": 1378826211.3440456,
       "bits": 49083742113326.88,
       "sats": 4908374211332688
     },
     "total_volume": {
       "btc": 1875775.1552219943,
       "eth": 23483221.11215919,
       "ltc": 589379205.0500202,
       "bch": 211415917.7324016,
       "bnb": 174857510.63960448,
       "eos": 27937259358.69287,
       "xrp": 103245956345.24774,
       "xlm": 327971698914.93256,
       "link": 4391561539.923059,
       "dot": 3355710010.1675816,
       "yfi": 3032079.369830742,
       "usd": 95289098926.11858,
       "aed": 349996860355.63293,
       "ars": 9743834455239.713,
       "aud": 131912701785.58061,
       "bdt": 8168289522495.957,
       "bhd": 35910649821.29698,
       "bmd": 95289098926.11858,
       "brl": 540752486510.07,
       "cad": 122082011316.6699,
       "chf": 87707612348.25966,
       "clp": 82465091992641.44,
       "cny": 606762866321.9521,
       "czk": 2106565638869.5896,
       "dkk": 626001735395.1355,
       "eur": 84159046304.25108,
       "gbp": 71190962253.19766,
       "hkd": 743278793898.4559,
       "huf": 31077586723764.332,
       "idr": 1351270889596555,
       "ils": 300333134886.3298,
       "inr": 7157683641219,
       "jpy": 10901692296290.98,
       "krw": 113110066207281.23,
       "kwd": 28832099107.570374,
       "lkr": 19296302385911.8,
       "mmk": 169426163801146.4,
       "mxn": 1964651583838.9304,
       "myr": 399737769995.0673,
       "ngn": 39158102312699.04,
       "nok": 844070838287.5571,
       "nzd": 139781580285.80066,
       "php": 4765843594344.567,
       "pkr": 16970988518741.697,
       "pln": 388850895153.65967,
       "rub": 7019233249645.195,
       "sar": 357771402647.9156,
       "sek": 869846539547.0724,
       "sgd": 129507414350.48761,
       "thb": 3183569059567.3657,
       "try": 1019136923725.6108,
       "twd": 2638964892389.595,
       "uah": 2593231079938.202,
       "vef": 9541297475.472244,
       "vnd": 2187361265849046.2,
       "zar": 1482793668389.3298,
       "xdr": 67956087922.85388,
       "xag": 4167470647.315769,
       "xau": 52692965.92416491,
       "bits": 1875775155221.9944,
       "sats": 187577515522199.44
     },
     "market_cap_percentage": {
       "btc": 38.527088982617606,
       "eth": 19.350171176849294,
       "bnb": 3.6749785495655414,
       "usdt": 3.1202214036706226,
       "sol": 2.359245649332171,
       "ada": 1.8360005602275409,
       "xrp": 1.7589690748717406,
       "usdc": 1.7042408360105559,
       "luna": 1.411660075923542,
       "dot": 1.2166402328623138
     },
     "market_cap_change_percentage_24h_usd": -1.1592878581051251,
     "updated_at": 1640432688
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }

        return ""
    }

    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }

        return ""
    }

    var btcDominance: String {
        if let item = totalMarketCap.first(where: { $0.key == "btc" }) {
            return "\(item.value.asPercentString())"
        }

        return ""
    }

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
}
